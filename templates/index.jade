- var sectionnames = _.chain(contents['sections']._.pages).sortBy(function (item) { return item.metadata['section'] + item.metadata['id'] }).map(function (item) { return item.metadata['section'] }).uniq().value();
- var sectionId = function (item) { return item.metadata['id'] }
doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
    meta(name='viewport', content='width=device-width')
    title= locals.name
    link(rel='alternate', href=locals.url+'/feed.xml', type='application/rss+xml', title=locals.description)
    link(rel='stylesheet', href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300')
    link(rel='stylesheet', href='/css/bootstrap.min.css')
    link(rel='stylesheet', href='/css/custom.css')
    script(type='text/javascript', src='/js/jquery-2.1.0.min.js')
    script(type='text/javascript', src='/js/bootstrap.min.js')
  body(data-spy="scroll" data-target="#nav")
    div.container
      div.row
        header.page-header
          h1
            a(href=locals.url)= locals.name
          small=locals.description
      div.row
        div.col-md-10
          for sectionname in sectionnames
            - var bySectionName = function (item) { return item.metadata['section'] === sectionname }
            h2(id=sectionname)= sectionname
              for item in _.chain(contents['sections']).filter(bySectionName).sortBy(sectionId).value()
                h3(id=item.metadata['id'])= item.metadata['title']
                section!= item.html
        div.col-md-2
          div#nav(data-spy="affix")
            ul.nav
              for sectionname in sectionnames
                - var bySectionName = function (item) { return item.metadata['section'] === sectionname }
                li
                  a(href='#'+sectionname)= sectionname
                  ul.nav
                    for item in _.chain(contents['sections']).filter(bySectionName).sortBy(sectionId).value()
                      li
                        a(href='#'+item.metadata['id'])=item.metadata['title']
    footer
      div.container
        div.row
          section
            p &copy; #{ new Date().getFullYear() } #{ locals.owner } &mdash; powered by&nbsp;
              a(href='https://github.com/jnordberg/wintersmith') Wintersmith